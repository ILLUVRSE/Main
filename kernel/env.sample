# Kernel service environment sample
# Copy this file and edit values for your environment before running.

# ---------------------------------------------------------
# Server / TLS / mTLS
# ---------------------------------------------------------
# Address the server listens on
LISTEN_ADDR=:8443

# TLS certificate and key for the server (required for TLS)
TLS_CERT_PATH=devops/certs/server.crt
TLS_KEY_PATH=devops/certs/server.key

# CA bundle used to validate client certs for mTLS
# If set, server can require client certs (see REQUIRE_MTLS).
TLS_CLIENT_CA_PATH=devops/certs/ca.crt

# When true, the server requires valid client certificates (mTLS)
REQUIRE_MTLS=true

# ---------------------------------------------------------
# OIDC / JWT / JWKS (OIDC middleware)
# ---------------------------------------------------------
# OIDC issuer (iss claim) expected in tokens
OIDC_ISSUER=https://accounts.example.com

# OIDC audience (aud claim) expected in tokens
OIDC_AUDIENCE=signing-api

# JWKS endpoint URL that exposes the issuer's public keys (jwks.json)
# Example for local dev: http://localhost:8000/jwks.json
JWKS_URL=http://localhost:8000/jwks.json

# How many seconds to cache the JWKS before refreshing (default 300)
JWKS_CACHE_TTL_SECONDS=300

# Notes:
# - Set JWKS_URL to enable JWT validation and RBAC mapping.
# - If JWKS_URL is empty, OIDC middleware is skipped and JWT roles are not validated.

# ---------------------------------------------------------
# KMS / Signing
# ---------------------------------------------------------
# RequireKMS controls whether an external KMS is mandatory in prod.
REQUIRE_KMS=false

# When using a KMS signing proxy, set endpoint here:
KMS_ENDPOINT=https://kms.example.com:443

# Local signer id used when KMS is not present (dev only)
LOCAL_SIGNER_ID=local-signer-1

# ---------------------------------------------------------
# Database & Audit streamer (durability)
# ---------------------------------------------------------
# Postgres DB (for manifests, registry, and durable audit store)
DATABASE_URL=postgres://user:pass@localhost:5432/kernel_db?sslmode=disable

# Kafka brokers and topic used by the audit streamer (when DB present)
KAFKA_BROKERS=broker1:9092,broker2:9092
KAFKA_TOPIC=audit-events

# S3 bucket & optional prefix used to archive audit batches
S3_BUCKET=my-audit-bucket
S3_PREFIX=audit-archive/

# Streamer tuning (optional)
STREAM_BATCH_SIZE=10
STREAM_MAX_CONCURRENCY=5
STREAM_POLL_INTERVAL_SECONDS=3

# ---------------------------------------------------------
# Runtime & Misc
# ---------------------------------------------------------
# Environment (development|production)
NODE_ENV=development

# Log level (informational guidance - adjust logging framework accordingly)
LOG_LEVEL=info

# Health & readiness expectations
# LISTEN_ADDR already defined above; readiness depends on DB and store

# ---------------------------------------------------------
# Notes / Runbook excerpts
# ---------------------------------------------------------
# Local dev JWKS:
#   - Use devops/tools/jwkgen to create devops/certs/jwks.json and devops/certs/test_jwt.txt
#   - Serve jwks.json with: devops/scripts/start_jwks_server.sh start
#
# Rotating JWKS keys:
#   - Rotate keys at the IdP, ensure JWKS endpoint has both new and old keys during rollout.
#   - JWKS cache TTL controls how long the server accepts keys before reloading.
#   - After rotation, monitor auth failures; increase JWKS logging if needed.
#
# mTLS notes:
#   - Server enforces mTLS when REQUIRE_MTLS=true.
#   - Client certificates must be signed by the CA in TLS_CLIENT_CA_PATH.
#
# Always avoid committing real secrets into env files. Use your secret manager in production.

